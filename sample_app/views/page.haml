%h1= @title

%p Last updated on #{date_format(@commits.last.date)}

- if @page.has_local_mods?
  %p
    %em
      Note:
      - if @page.shown_local_mods?
        Showing local modifications.
        - unless @commit.simulated?
          View the
          %a{ href: @commits.last.url } most recent commit
          instead.
      - else
        This page has
        = succeed '.' do
          %a{ href: @page.url } local modifications

- unless @commit.latest?
  %p
    %em
      The content you are viewing is out of date. View the
      %a{ href: @page.url } most recent revision.
      -#was updated on
      -#%a{ href: "#commit-#{c.id}" } #{date_format(c.date)}.

~ @content

%h3 Tags
%ul#tags
  - @page.tags.each do |tag|
    %li
      %a{ href: tag_url(tag) }= tag

%h3 Categories
%ul#categories
  - @page.categories.each do |cat|
    %li
      %a{ href: cat_url(cat) }= cat

%h3 Revisions
%ul#revisions
  - @commits.reverse.each do |c|
    %li{ class: c.shown? && 'shown', id: "commit-#{c.id}" }
      %a{ href: c.url }
        %span.date= date_format(c.date)
        \-
        %span.message= c.message
      = surround '(', ')' do
        - if c.author.email
          %a{ href: "mailto:#{c.author.email}" }= c.author.name
        - else
          = c.author.name
      -#%span.author= c.committer
      - if true
        %ul.diffs
          - c.diffs.each do |d|
            - link = capture_haml do
              %a{ href: d.url } #{d.file}
            %li{ class: d.status }
              %span.title #{link} #{d.status}
              ~ render_diff(d) unless d.deleted?
